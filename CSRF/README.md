Cross Site Request Forgery (CSRF)
================================

## What is Cross Site Request Forgery (CSRF) ??

- CSRF is an attack vector that tricks a web browser into executing an unwanted action in an application to which a user is logged in.

- CSRF is a flaw using which an attacker, after making user visit hacker controlled website sends a arequest to the vulnerable website from the user's browser with the user's cookies which authorises actions carried out on the website on the victim's behalf i.e. 

- the attacker can forge requests as to being sent by a victim from a "Cross Site" (different website) than the website to which the request is going and since there is no checking as to where the request is coming from, the forged request is accepted and actions carried out on behalf of the user who visited the "Cross Site".

- CSRFs are typically conducted using malicious social engineering, such as an email or link that tricks the victim into sending a forged request to a server.
#
## Some important points about CSRF:

 To carry out a successful CSRF attack, consider the following:
 - The success of a CSRF attack depends on a userâ€™s session with a vulnerable application. The attack will only be successful if the user is in an active session with the vulnerable application.

  - An attacker must find a valid URL to maliciously craft. The URL needs to have a state-changing effect on the target application.
  - An attacker also needs to find the right values for the URL parameters. Otherwise, the target application might reject the malicious request.

#
## How does CSRF work?

### For a CSRF attack to be possible, three key conditions must be in place:

- A relevant action. 
    - There is an action within the application that the attacker has a reason to induce. 
- Cookie-based session handling. 
    - Performing the action involves issuing one or more HTTP requests, and the application relies solely on session cookies to identify the user who has made the requests. 
- No unpredictable request parameters. 
    - The requests that perform the action do not contain any parameters whose values the attacker cannot determine or guess. 

#
## Simulation of CSRF:

- I will try to simulate a CSRF with the help of a lab. 
- The lab has an email changing functionality and we will try to exploit it as it is vulnerable to CSRF.

    Lab link : https://rb.gy/4hnpyf

- After accessing the lab we will go to to "My Account" option as shown in the below image.

  ![1](https://user-images.githubusercontent.com/125211284/222327887-5382c713-3e66-4e8c-8a88-339d8ac61b0b.png)

- We will be shown a login page just like the one shown below
        
        The credentials are wiener:peter


- After logging in we can see that there is a feature to update the email address.
- We will try to exploit this feature.

        The current email is wiener@normal-user.net


- Now we start our "BurpSuite" and turn the intercept on

    ![2023-03-01 20_12_00-Kali  Running  - Oracle VM VirtualBox](https://user-images.githubusercontent.com/125211284/222184331-6a306830-0a2b-4630-a92d-bd2e4160a530.png)

- After turning on the proxy of our browser we try to change the email to "test@gmail.com"

- And we see in BurpSuite that our request is using "POST" method and a paramter named "email" to change the email.
- We will now forge a CSRF HTML form (payload).

- Here we create a form directing towards the user's website and including an hidden input with the same name as of the parameter and desired value in the "value" attibute.

- Now if the attacker can somehow make the user of the website go to the above HTML page we can change the email  successfully.

- Now if the user click the "change email" button on the attacker's website

- We will see the email has been changed to 

        hacker@gmail.com


![2](https://user-images.githubusercontent.com/125211284/222327896-f49c9645-5f7e-405e-b355-744eb7d33aa0.png)
![3 ](https://user-images.githubusercontent.com/125211284/222327924-936822fe-0b6f-4196-8a0c-39bf7dc72cf3.png)
![4](https://user-images.githubusercontent.com/125211284/222327926-9cf19542-c303-4412-967f-f1f520185078.png)
![5](https://user-images.githubusercontent.com/125211284/222327932-14f9e8dc-b335-4bf0-bb13-6ab9108f6cf9.png)

![6](https://user-images.githubusercontent.com/125211284/222327936-614898dc-b66e-4c76-a492-f478e11038f0.png)
![7](https://user-images.githubusercontent.com/125211284/222327940-057c7c13-fe83-4718-8653-bd511a45b29f.png)
![8](https://user-images.githubusercontent.com/125211284/222327942-f47fd8db-f052-450c-a4af-bfe03a9fa226.png)

#
## How to prevent CSRF??

- Use CSRF tokens: 
    - CSRF tokens are random values that are generated by the server and included in every form that a user submits. The server verifies the token with each form submission to ensure that the request came from an authentic source.

- Use HTTP-only cookies: 
    -  HTTP-only cookies can prevent malicious JavaScript code from reading or modifying the cookie value. This can help prevent CSRF attacks from being executed through XSS (Cross-Site Scripting) attacks.

- Use same-site cookies: 
    - Same-site cookies restrict the scope of a cookie to the same site that set it. This can help prevent CSRF attacks from being executed by limiting the scope of the cookie.

- Implement multi-factor authentication: 
    - Multi-factor authentication can provide an additional layer of security that can prevent CSRF attacks. If the attacker does not have access to the victim's second authentication factor, then they will not be able to execute the attack.

- Use secure coding practices: 
    - Developers should follow secure coding practices to avoid introducing vulnerabilities that can be exploited by attackers. This includes input validation, output encoding, and avoiding the use of user-supplied data in sensitive operations.

- Use HTTPS: 
    - HTTPS encrypts data in transit, which can prevent attackers from intercepting and modifying requests. This can help prevent CSRF attacks from being executed.
